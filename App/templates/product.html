{% extends "base.html" %}

{% block content %}

<div class="panel panel-default">
    <div class="panel-heading">Detalles</div>
    <div class="panel-body">

      <form action="" method="post">
        <div class="form-group">
          <label for="name">Nombre</label>
          <input type="text" class="form-control" name="name" id="name" value="{{ product[1] }}">
        </div>

        <div class="form-group">
          <label for="minWeight">Peso mínimo</label>
          <input type="text" class="form-control" name="minWeight" id="minWeight" value="{{ product[2] }}">
        </div>

        <div class="form-group">
          <label for="maxWeight">Peso máximo</label>
          <input type="text" class="form-control" name="maxWeight" id="maxWeight" value="{{ product[3] }}">
        </div>

        <button type="submit" class="btn btn-default">{% if mode == 'update' %}Actualizar{% else %}Crear{% endif %}</button>
      </form>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">Ultimas mediciones</div>
    <div class="panel-body">
      {% if measurements %}
      <div class="pull-right" style="padding:20px;">
        <button onclick="downloadCSV()">Descargar como CSV</button>
      </div>
      <table class="table">
        <tr><th>Escala</th><th>Peso</th><th>Fecha y hora</th></tr>
        {% for m in measurements %}
            <tr><td>{{ m[2] }}</td><td>{{ m[3] }}</td><td>{{ m[4] }}</td></tr>
        {% endfor %}
      </table>
      {% else %}
      <span>No hay mediciones registradas.</span>
      {% endif %}
    </div>
</div>

{% endblock %}

{% block additionaljs %}
    <script>

        var webSocket = null;
        var webSocketURI = "ws://{{serverAddr}}:{{serverPort}}/ws";

        function downloadCSV() {
            webSocket = new WebSocket(webSocketURI);
            
            webSocket.onopen = function() {
                console.log("Conectado a: " + webSocketURI);
            }

            webSocket.onclose = function(e) {
                console.log("Desconectado de: " + webSocketURI + ", " + e);
            }

            webSocket.onmessage = function(e) {
                console.log("Mensaje recibido: " + e.data);
            }
        };

    </script>
{% endblock %}
